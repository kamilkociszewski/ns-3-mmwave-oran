<!DOCTYPE html>
<html>
<head>
    <title>UEs and Cells Chart</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            background-color: #0d0d0d;
            color: #ff8c00;
            font-family: 'Roboto', sans-serif;
        }

        #main-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            box-sizing: border-box;
        }

        #form-buttons {
            margin: 0 auto;
        }

        #form-container {
            display: none;
            background: #1a1a1a;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        #simulationForm {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
        }

        #simulationForm label {
            font-weight: 700;
            margin-bottom: 5px;
        }

        #simulationForm input {
            padding: 10px;
            border-radius: 5px;
            border: none;
            background: #333;
            color: #ff8c00;
            width: 100%;
        }

        #form-toggle-button {
            background: #ff8c00;
            color: #1a1a1a;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        #tab-container {
            display: flex;
            background: #1a1a1a;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            padding: 5px;
        }

        .tab-button {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            color: #ff8c00;
            background: #333;
            border-radius: 5px;
            margin: 0 5px;
        }

        .tab-button.active {
            background: #ff8c00;
            color: #1a1a1a;
        }

        .tab-content {
            display: none;
            flex: 1;
            background: #1a1a1a;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        #chart-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #chart-content canvas {
            width: 100%;
            height: 100%;
            max-height: 80vh;
            max-width: 100%;
        }

        #data-content {
            flex: 1.2;
        }

        #es-content {
            flex: 1.2;
        }

        .es-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            height: 100%;
        }

        .es_charts_left {
            flex: 85;
            min-width: 0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .es_charts_right {
            flex: 15;
            min-width: 0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .es_subchart_div {
            height: 220px;
        }

        .data-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            height: 100%;
            overflow-y: auto;
        }

        .data-section {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }

        h3 {
            text-align: center;
            margin-bottom: 10px;
        }

        .scrollable-data {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            border: 1px solid #ccc;
            overflow-y: auto;
            background: #1a1a1a;
            padding: 10px;
        }

        .object-box {
            border: 1px solid #ff8c00;
            padding: 10px;
            background-color: #1a1a1a;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }

        .value {
            color: lightblue;
        }

        .custom-legend.horizontal {
            display: flex;
            flex-wrap: wrap;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            overflow-x: auto;
        }

        .custom-legend.vertical {
            display: flex;
            flex-direction: column;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .legend-item {
            margin: 5px;
        }

        .legend-color-box {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 10px;
            vertical-align: middle;
        }

        .legend-text {
            vertical-align: middle;
        }

        #simulationForm button {
            grid-column: span 1;
            padding: 10px;
            border-radius: 5px;
            border: none;
            background: #ff8c00;
            color: #1a1a1a;
            cursor: pointer;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        #loading-icon {
            display: none;
            color: #ff8c00;
            font-size: 24px;
        }

        #simulationForm button {
            padding: 10px;
            border-radius: 5px;
            border: none;
            background: #ff8c00;
            color: #1a1a1a;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s ease;
        }

        #simulationForm button:active {
            background: #e07b00;
        }

        #simulationForm button:disabled {
            background: #4d4d4d;
            color: #7a7a7a;
            cursor: not-allowed;
        }

        #toggleButton {
            background: #ff8c00;
            color: #1a1a1a;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 10px;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            width: 100%;
        }

        .input-row {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            width: 100%;
        }

        .label-row label,
        .input-row input {
            flex: 1;
            text-align: left;
        }

        .input-row input {
            padding: 10px;
            font-size: 14px;
            color: #ff8c00;
            background: #333;
            border: none
        }

        .button-row {
            display: flex;
            gap: 20px;
        }

        .button-row button {
            flex: 1;
            padding: 10px 15px;
            cursor: pointer;
            background: #ff8c00;
            color: #1a1a1a;
            border: none
        }

        .frame-row {
            display: flex;
            gap: 20px;
        }

        .response-frame {
            flex: 1;
            padding: 10px;
            background-color: #333;
            min-height: 100px;
            text-align: center;
            word-wrap: break-word;
            border: none
        }

        .put-row {
            display: flex;
            gap: 20px;
        }

        .put-row label {
            font-weight: bold;
        }

        .put-row input,
        .put-row textarea {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            box-sizing: border-box;
            color: #ff8c00;
            background: #333;
            border: none
        }

        .put-row button {
            padding: 10px 15px;
            cursor: pointer;
        }

        .hidden {
            display: none;
        }

        .space_in_form {
            height: 5px;
            width: 110%;
            background-color: #ff8c00;
        }

        .last_space_in_form {
            height: 5px;
            background-color: #ff8c00;
        }
    </style>
</head>
<body>
<div id="main-container">
    <div id="form-buttons">
        <button id="form-toggle-button">Show simulation setup</button>
        <button id="toggleButton">Show A1 policy manager</button>
    </div>
    <div id="form-container">
        <form id="simulationForm">
            <div>
                <div style="display: flex; flex-direction: column;">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <label for="flexric">Connect to FlexRIC: (If true, FlexRIC need to be running) </label>
                        <input type="checkbox" id="flexric" name="flexric" value="true"
                               style="transform: scale(1.5); margin-left: 0;">
                    </div>
                    <div style="display: flex; align-items: center;">
                        <label for="e2TermIp" style="margin-right: 8px; width: 100px;">e2TermIp:</label>
                        <input type="text" id="e2TermIp" name="e2TermIp" value="127.0.0.1" disabled
                               style="flex: 1; background-color: lightgray;">
                    </div>
                </div>
            </div>
            <div>
                <label for="hoSinrDifference">hoSinrDifference (dB):</label>
                <input type="number" id="hoSinrDifference" name="hoSinrDifference" value="3" step="">
            </div>
            <div>
                <label for="indicationPeriodicity">indicationPeriodicity (s):</label>
                <input type="number" id="indicationPeriodicity" name="indicationPeriodicity" value="0.1" step="">
            </div>
            <div>
                <label for="simTime">simTime (s):</label>
                <input type="number" id="simTime" name="simTime" value="1000">
            </div>
            <div>
                <label for="KPM_E2functionID">KPM_E2functionID:</label>
                <input type="number" id="KPM_E2functionID" name="KPM_E2functionID" value="2">
            </div>
            <div>
                <label for="RC_E2functionID">RC_E2functionID:</label>
                <input type="number" id="RC_E2functionID" name="RC_E2functionID" value="3">
            </div>
            <div>
                <label for="N_MmWaveEnbNodes">N_MmWaveEnbNodes:</label>
                <input type="number" id="N_MmWaveEnbNodes" name="N_MmWaveEnbNodes" value="4">
            </div>
            <!--<div>
                <label for="N_LteEnbNodes">N_LteEnbNodes:</label>
                <input type="number" id="N_LteEnbNodes" name="N_LteEnbNodes" value="1">
            </div> -->
            <div>
                <label for="N_Ues">N_Ues:</label>
                <input type="number" id="N_Ues" name="N_Ues" value="3">
            </div>
            <div>
                <label for="CenterFrequency">CenterFrequency (Hz):</label>
                <input type="number" id="CenterFrequency" name="CenterFrequency" value="3.5e9" step="">
            </div>
            <div>
                <label for="Bandwidth">Bandwidth (Hz):</label>
                <input type="number" id="Bandwidth" name="Bandwidth" value="20e6" step="">
            </div>
            <!--<div>
                <label for="N_AntennasMcUe">N_AntennasMcUe:</label>
                <input type="number" id="N_AntennasMcUe" name="N_AntennasMcUe" value="">
            </div>
            <div>
                <label for="N_AntennasMmWave">N_AntennasMmWave:</label>
                <input type="number" id="N_AntennasMmWave" name="N_AntennasMmWave" value="">
            </div> -->
            <div>
                <label for="IntersideDistanceUEs">IntersideDistanceUEs (m):</label>
                <input type="number" id="IntersideDistanceUEs" name="IntersideDistanceUEs" value="1000">
            </div>
            <div>
                <label for="IntersideDistanceCells">IntersideDistanceCells (m):</label>
                <input type="number" id="IntersideDistanceCells" name="IntersideDistanceCells" value="1000">
            </div>
            <div>
                <label>Status: </label>
                <label id="status_label" style="text-align: center">off </label>
                <label id="label_between_status_and_simid"></label>
                <label id="simid_label" style="text-align: center; color: white"></label>
            </div>
            <button type="button" onclick="sendForm('/start_simulation')" id="start_button">Start new</button>
            <button type="button" onclick="stopSim('/stop_simulation')" id="stop_button" disabled>Stop</button>
            <button type="button" onclick="resetSim('/reset_simulation')" id="reset_button" >Reset</button>
            <div><label id="warning_label"></label></div>
            <div></div>
            <div></div>
            <div></div>
            <div class="space_in_form"></div>
            <div class="space_in_form"></div>
            <div class="space_in_form"></div>
            <div class="last_space_in_form"></div>
            <div>
                <label style="font-size: 30px; font-weight: bold">Cell energy states management: </label>
            </div>
            <div>
                <center>
                    <label>ES status: </label>
                    <label id="es_status_label">off</label>
                </center>
            </div>
            <button type="button" onclick="startEs()" style="background-color: green"
                    id="set_es_button">Turn ES on
            </button>
            <button type="button" onclick="stopEs()" style="background-color: olive"
                    id="set_es_button">Turn ES off
            </button>
        </form>
    </div>
    <div id="frameContainer" class="hidden">
        <div class="container">
            <!-- GET Inputs and Buttons Row -->
            <div class="label-row">
                <label for="param1">POLICY TYPE id:</label>
                <label for="param2">POLICY INSTANCE id:</label>
            </div>
            <div class="input-row">
                <input id="param1" placeholder="Enter POLICY TYPE id to fetch or create:"/>
                <input id="param2" placeholder="Enter POLICY INSTANCE id to fetch or create:"/>
            </div>
            <div class="button-row">
                <button id="fetchData1">Get POLICY TYPE list</button>
                <button id="fetchData2">Get JSON body of POLICY TYPE id from "POLICY TYPE id:" field</button>
                <button id="fetchData3">Get POLICY INSTANCE list</button>
                <button id="fetchData4">Get JSON body of POLICY INSTANCE id from "POLICY INSTANCE id:" field</button>
            </div>

            <!-- GET Response Frames Row -->
            <div class="frame-row">
                <div id="response1" class="response-frame">Return current POLICY TYPE list.</div>
                <div id="response2" class="response-frame">Return JSON body of chosen POLICY TYPE id.<br> "POLICY TYPE
                    id:" must be fulfilled.
                </div>
                <div id="response3" class="response-frame">Return current POLICY INSTANCE list.<br> "POLICY TYPE id:"
                    must be fulfilled.
                </div>
                <div id="response4" class="response-frame">Return JSON body of chosen POLICY INSTANCE id. <br> "POLICY
                    TYPE id:" and "POLICY INSTANCE id:" must be fulfilled.
                </div>
            </div>
            <div class="put-row">
                <textarea id="putJson1" placeholder="Enter JSON payload for new POLICY TYPE creation:"></textarea>
                <textarea id="putJson2" placeholder="Enter JSON payload for new POLICY INSTANCE creation:"></textarea>
            </div>

            <!-- PUT Rows -->
            <div class="button-row">
                <button id="sendPut1">Create POLICY TYPE id (with id from field "Policy TYPE id:" and JSON body inputed
                    above)
                </button>
                <button id="sendPut2">Create POLICY INSTANCE id (with id from field "Policy INSTANCE id:" and JSON body
                    inputed above)
                </button>
            </div>
            <div class="frame-row">
                <div id="putResponse1" class="response-frame">
                    Example POLICY TYPE JSON body: <br>
                    {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;"name": "tsapolicy",<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;"description": "tsa parameters",<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;"policy_type_id": 40008,<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;"create_schema": {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"$schema":
                    "http://json-schema.org/draft-07/schema#",<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"type": "object",<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"properties": {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"threshold": {<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"type":
                    "integer",<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"default":
                    0<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"additionalProperties": false<br>
                    &nbsp;&nbsp;&nbsp;&nbsp;}<br>
                    }<br>
                </div>
                <div id="putResponse2" class="response-frame">Example POLICY INSTANCE JSON body:<br>
                    {"threshold": 10}<br>
                </div>
            </div>
        </div>
    </div>
    <div id="tab-container">
        <div id="chart-tab" class="tab-button active">Observe simulation grid</div>
        <div id="data-tab" class="tab-button">Observe KPIs</div>
        <div id="es-tab" class="tab-button">Observe ES</div>
    </div>
    <div id="chart-content" class="tab-content active">
        <canvas id="myChart"></canvas>
        <div id="chart-legend" class="custom-legend"></div>
    </div>
    <div id="data-content" class="tab-content">
        <div class="data-container">
            <div class="data-section">
                <h3>UE Data</h3>
                <div id="ueSourceData" class="scrollable-data"></div>
            </div>
            <div class="data-section">
                <h3>Cell Data</h3>
                <div id="cellSourceData" class="scrollable-data"></div>
            </div>
        </div>
    </div>
    <div id="es-content" class="tab-content">
        <div class="data-container">
            <div class="es_charts_left">
                <div class="es_subchart_div" style="height: 140px">
                    <canvas id="es-mode-chart"></canvas>
                </div>
                <div class="es_subchart_div">
                    <canvas id="sinr-chart"></canvas>
                </div>
                <div class="es_subchart_div">
                    <canvas id="retx-chart"></canvas>
                </div>
                <div class="es_subchart_div">
                    <canvas id="prb-usage-chart"></canvas>
                </div>
                <div style="display: flex; justify-content: center; align-items: center; text-align: center;">
                    <label style="font-size: 20px; font-weight: bold; color: white;">
                        Dots on plot represent UEs cell allocation (DOT color = CELL color), line colors represent
                        unique UEs
                    </label>
                </div>
            </div>
            <div class="es_charts_right">
                <canvas id="es_diff"></canvas>
            </div>

        </div>
    </div>
</div>

<script>
    document.getElementById('flexric').addEventListener('change', function () {
        var e2TermIpField = document.getElementById('e2TermIp');
        if (this.checked) {
            e2TermIpField.disabled = false;
            e2TermIpField.style.backgroundColor = "";
        } else {
            e2TermIpField.disabled = true;
            e2TermIpField.value = "127.0.0.1";
            e2TermIpField.style.backgroundColor = "lightgray";
        }
    });


    var ctx = document.getElementById('myChart').getContext('2d');

    var myChart = new Chart(ctx, {
        type: 'scatter',
        data: {
            datasets: [
                {
                    label: 'UEs',
                    data: [],
                    backgroundColor: [],
                    borderWidth: 1,
                    pointRadius: 6,
                    pointStyle: 'circle',
                    datalabels: {
                        align: 'top',
                        color: '#ff8c00',
                        formatter: function (value, context) {
                            return `UE (${value.x.toFixed(1)}, ${value.y.toFixed(1)})`;
                        },
                        offset: 6,
                        padding: {
                            bottom: 6
                        }
                    }
                },
                {
                    label: 'Cells',
                    data: [],
                    backgroundColor: [],
                    borderWidth: 1,
                    pointRadius: 20,
                    pointStyle: 'triangle',
                    datalabels: {
                        align: 'top',
                        color: '#ff4500',
                        formatter: function (value, context) {
                            return `Cell (${value.x.toFixed(1)}, ${value.y.toFixed(1)})`;
                        },
                        offset: 12,
                        padding: {
                            bottom: 12
                        }
                    }
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'linear',
                    position: 'bottom',
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    ticks: {
                        color: '#ff8c00',
                        callback: function (value) {
                            return value;
                        }
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    ticks: {
                        color: '#ff8c00'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: 'RIC TaaP Studio',
                    color: '#ff8c00',
                    font: {
                        size: 18
                    }
                },
                tooltip: {
                    callbacks: {
                        title: function (tooltipItems) {
                            return '';
                        },
                        label: function (context) {
                            const dataset = context.dataset;
                            const index = context.dataIndex;
                            const dataPoint = dataset.data[index];

                            let label = dataset.label || '';
                            if (dataPoint) {
                                if (dataset.label === 'UEs') {
                                    label += `\nID: ${dataPoint.ue_id}`;
                                } else if (dataset.label === 'Cells') {
                                    label += `\nID: ${dataPoint.cell_id}`;
                                }
                                label += `\nX: ${dataPoint.x.toFixed(1)}`;
                                label += `\nY: ${dataPoint.y.toFixed(1)}`;
                                if (dataset.label === 'UEs') {
                                    label += `\nType: ${dataPoint.type}`;
                                    label += `\nConnected to Cell: ${dataPoint.MMWave_Cell || 'N/A'}`;
                                } else if (dataset.label === 'Cells') {
                                    label += `\nType: ${dataPoint.type}`;
                                }
                            }
                            return label;
                        }
                    }
                },
                datalabels: {
                    display: true
                }
            }
        },
        plugins: [ChartDataLabels]
    });

    const ctx2 = document.getElementById('es_diff').getContext('2d');


    const actualEsChart = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: [],
            datasets: []
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    beginAtZero: true,
                    ticks: {
                        callback: function (value, index, values) {
                            return this.getLabelForValue(value).split('\n');
                        },
                        maxRotation: 0,
                        minRotation: 0,
                        padding: 10,
                        color: '#FFFFFF',
                        font: {
                            size: 10
                        },
                    },
                },
                y: {
                    beginAtZero: true
                },
            },
            plugins: {
                legend: {
                    display: false
                },
                title: {
                    display: true,
                    text: 'Difference in power consumption between modes',
                    color: '#FFFFFF',
                    font: {
                        size: 16
                    },
                    padding: {
                        top: 10,
                        bottom: 10
                    },
                    align: 'center'
                },
                tooltip: {
                    callbacks: {
                        label: function (tooltipItem) {
                            return tooltipItem.raw;
                        }
                    }
                }
            }
        }
    });


    const ctx3 = document.getElementById('es-mode-chart').getContext('2d');
    const ctx4 = document.getElementById('sinr-chart').getContext('2d');
    const ctx5 = document.getElementById('retx-chart').getContext('2d');
    const ctx6 = document.getElementById('prb-usage-chart').getContext('2d');

    const es_mode_chart = new Chart(ctx3, {
        type: 'line',
        data: {
            labels: Array.from({length: 51}, (_, i) => -50 + i),

        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Timeline',
                        color: '#ff8c00',
                        font: {
                            size: 14
                        }
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    ticks: {
                        color: '#ff8c00'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'ES MODE',
                        color: '#ff8c00',
                        font: {
                            size: 14
                        }
                    },
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    min: 0,
                    max: 1,
                    ticks: {
                        stepSize: 1,
                        color: '#ff8c00'
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: '#ff8c00'
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            return `Cell ${context.dataset.cell_id}: ${context.raw}`;
                        }
                    }
                }
            }
        }
    });

    const sinr_chart = new Chart(ctx4, {
        type: 'line',
        data: {
            labels: Array.from({length: 51}, (_, i) => -50 + i),
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Timeline',
                        color: '#ff8c00',
                        font: {
                            size: 14
                        }
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    ticks: {
                        color: '#ff8c00'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Serving SINR',
                        color: '#ff8c00',
                        font: {
                            size: 14
                        }
                    },
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    ticks: {
                        color: '#ff8c00'
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: '#ff8c00'
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            return `UE ${context.dataset.ueid}: ${context.raw}`;
                        }
                    }
                }
            }
        }
    });

    const retx_chart = new Chart(ctx5, {
        type: 'line',
        data: {
            labels: Array.from({length: 51}, (_, i) => -50 + i),

        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Timeline',
                        color: '#ff8c00',
                        font: {
                            size: 14
                        }
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    ticks: {
                        color: '#ff8c00'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'RETX',
                        color: '#ff8c00',
                        font: {
                            size: 14
                        }
                    },
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    ticks: {
                        color: '#ff8c00'
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: '#ff8c00'
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            return `UE ${context.dataset.ueid}: ${context.raw}`;
                        }
                    }
                }
            }
        }
    });

    const prb_usage_chart = new Chart(ctx6, {
        type: 'line',
        data: {
            labels: Array.from({length: 51}, (_, i) => -50 + i),

        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Timeline',
                        color: '#ff8c00',
                        font: {
                            size: 14
                        }
                    },
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    ticks: {
                        color: '#ff8c00'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'PRB usage',
                        color: '#ff8c00',
                        font: {
                            size: 14
                        }
                    },
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.2)'
                    },
                    ticks: {
                        color: '#ff8c00'
                    }
                }
            },
            plugins: {
                legend: {
                    display: true,
                    labels: {
                        color: '#ff8c00'
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function (context) {
                            return `Cell ${context.dataset.cell_id}: ${context.raw}`;
                        }
                    }
                }
            }
        }
    });

    function updateChart() {
        fetch('/refresh-data')
                .then(response => response.json())
                .then(data => {

                    const cellColors = [
                        '#1f77b4', '#9467bd', '#2ca02c', '#d62728', '#ff7f0e',
                        '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf',
                        '#9e4f96', '#e57373', '#66c2a5', '#ffcc00', '#b3b3b3',
                        '#ff1f7a', '#6b5b95', '#4daf4a', '#f4b400', '#4e73df'
                    ];

                    const ueColors = [
                        '#f39c12', '#8e44ad', '#e74c3c', '#2ecc71', '#3498db',
                        '#9b59b6', '#34495e', '#f1c40f', '#1abc9c', '#d35400',
                        '#8e44ad', '#27ae60', '#2980b9', '#16a085', '#e67e22',
                        '#f7b7a3', '#c0392b', '#9b59b6', '#e91e63', '#f44336'
                    ];

                    const cellColorMap = new Map(data.cells.map((cell, index) => [
                        cell.cell_id, cellColors[index % cellColors.length]
                    ]));

                    const ueColorMap = new Map(data.ues.map((ue, index) => [
                        ue.ue_id, cellColors[index % ueColors.length]
                    ]));

                    const simIdLabel = document.getElementById('simid_label');
                    const joinLabel = document.getElementById('label_between_status_and_simid')
                    if (data.sim_id != 'off') {
                        joinLabel.textContent = ', simulation id = '
                        simIdLabel.textContent = data.sim_id;
                    } else {
                        joinLabel.textContent = ''
                        simIdLabel.textContent = '';
                    }

                    const cellData = data.cells.map(cell => ({
                        x: cell.x_position,
                        y: cell.y_position,
                        cell_id: cell.cell_id,
                        type: cell.type,
                        backgroundColor: cellColorMap.get(cell.cell_id),
                        pointStyle: cell.type === 'lte' ? 'rect' : 'triangle'
                    }));

                    const ueData = data.ues.map(ue => ({
                        x: ue.x_position,
                        y: ue.y_position,
                        ue_id: ue.ue_id,
                        type: ue.type,
                        MMWave_Cell: ue.MMWave_Cell,
                        LTE_Cell: ue.LTE_Cell,
                        backgroundColor: cellColorMap.get(ue.MMWave_Cell)
                    }));

                    myChart.data.datasets[0].data = ueData;
                    myChart.data.datasets[0].backgroundColor = ueData.map(ue => ue.backgroundColor);
                    myChart.data.datasets[1].data = cellData;
                    myChart.data.datasets[1].backgroundColor = cellData.map(cell => cell.backgroundColor);
                    myChart.data.datasets[1].pointStyle = cellData.map(cell => cell.pointStyle);
                    var chartDimensions = data.max_x_max_y;
                    myChart.options.scales.x.min = 0;
                    myChart.options.scales.x.max = chartDimensions[0];
                    myChart.options.scales.y.min = 0;
                    myChart.options.scales.y.max = chartDimensions[1];

                    myChart.update();

                    if (data.simulation_status === 'off') {
                        return;
                    }
                    const esState = data.es_state;
                    Object.keys(esState).forEach(cellId => {
                        const intCellId = parseInt(cellId, 10);
                        let dataset = es_mode_chart.data.datasets.find(d => d.label === `Cell ${cellId}`);
                        if (!dataset) {
                            dataset = {
                                label: `Cell ${cellId}`,
                                cell_id: intCellId,
                                data: Array(es_mode_chart.data.labels.length).fill(0),
                                backgroundColor: cellColorMap.get(intCellId),
                                borderColor: cellColorMap.get(intCellId),
                                borderWidth: 2,
                                fill: false
                            };
                            es_mode_chart.data.datasets.push(dataset);
                        }

                        const currentValue = esState[cellId] !== null && esState[cellId] !== undefined ? esState[cellId] : 0;
                        dataset.data.push(currentValue);
                        if (dataset.data.length > es_mode_chart.data.labels.length) {
                            dataset.data.shift();
                        }
                    });
                    es_mode_chart.update();

                    const sinr = data.sinr;
                    Object.keys(sinr).forEach(ueId => {
                        const intUeId = parseInt(ueId, 10);
                        let dataset = sinr_chart.data.datasets.find(d => d.label === `Ue ${ueId}`);
                        const ue = data.ues.find(ue => parseInt(ue.ue_id, 10) === intUeId);
                        const serv_cell_id = parseInt(ue.L3servingSINR_CellID, 10);
                        const cellColor = cellColorMap.get(serv_cell_id) || 'black';
                        if (!dataset) {
                            dataset = {
                                label: `Ue ${ueId}`,
                                ueid: intUeId,
                                data: Array(sinr_chart.data.labels.length).fill(0),
                                backgroundColor: 'black',
                                borderColor: Array(sinr_chart.data.labels.length - 1).fill('white'),
                                borderWidth: 0.5,
                                fill: false,
                                pointBackgroundColor: Array(sinr_chart.data.labels.length).fill('black'),
                                pointBorderColor: Array(sinr_chart.data.labels.length).fill('black'),
                                pointHoverRadius: 9,
                            };
                            sinr_chart.data.datasets.push(dataset);
                        }

                        const currentValue = sinr[ueId] !== null && sinr[ueId] !== undefined ? sinr[ueId] : 0;
                        dataset.data.push(currentValue);
                        dataset.data.shift();
                        dataset.pointBackgroundColor.push(cellColor);
                        dataset.pointBackgroundColor.shift();
                        dataset.pointBorderColor.push(cellColor);
                        dataset.pointBorderColor.shift();
                        dataset.backgroundColor = cellColor;


                    });

                    sinr_chart.update();

                    const retx = data.retx;
                    Object.keys(retx).forEach(ueId => {
                        const intUeId = parseInt(ueId, 10);
                        let dataset = retx_chart.data.datasets.find(d => d.label === `Ue ${ueId}`);
                        const ue = data.ues.find(ue => parseInt(ue.ue_id, 10) === intUeId);
                        const serv_cell_id = parseInt(ue.L3servingSINR_CellID, 10);
                        const cellColor = cellColorMap.get(serv_cell_id) || 'black';
                        if (!dataset) {
                            dataset = {
                                label: `Ue ${ueId}`,
                                ueid: intUeId,
                                data: Array(retx_chart.data.labels.length).fill(0),
                                backgroundColor: 'black',
                                borderColor: Array(retx_chart.data.labels.length - 1).fill('white'),
                                borderWidth: 0.5,
                                fill: false,
                                pointBackgroundColor: Array(retx_chart.data.labels.length).fill('black'),
                                pointBorderColor: Array(retx_chart.data.labels.length).fill('black'),
                                pointHoverRadius: 9,
                            };
                            retx_chart.data.datasets.push(dataset);
                        }

                        const currentValue = retx[ueId] !== null && retx[ueId] !== undefined ? retx[ueId] : 0;
                        dataset.data.push(currentValue);
                        dataset.data.shift();
                        dataset.pointBackgroundColor.push(cellColor);
                        dataset.pointBackgroundColor.shift();
                        dataset.pointBorderColor.push(cellColor);
                        dataset.pointBorderColor.shift();
                        dataset.backgroundColor = cellColor;
                    });
                    retx_chart.update();

                    const prb_usage = data.prb;
                    Object.keys(prb_usage).forEach(cellId => {
                        let dataset = prb_usage_chart.data.datasets.find(d => d.label === `Cell ${cellId}`);
                        const intCellId = parseInt(cellId, 10);
                        if (!dataset) {
                            dataset = {
                                label: `Cell ${cellId}`,
                                cell_id: intCellId,
                                data: Array(prb_usage_chart.data.labels.length).fill(0),
                                backgroundColor: cellColorMap.get(intCellId),
                                borderColor: cellColorMap.get(intCellId),
                                borderWidth: 2,
                                fill: false
                            };
                            prb_usage_chart.data.datasets.push(dataset);
                        }
                        const currentValue = prb_usage[cellId] !== null && prb_usage[cellId] !== undefined ? prb_usage[cellId] : 0;
                        dataset.data.push(currentValue);
                        if (dataset.data.length > prb_usage_chart.data.labels.length) {
                            dataset.data.shift();
                        }
                    });
                    prb_usage_chart.update();

                    if (actualEsChart) {
                        const startingPower = data.starting_power || 0;
                        const currentPower = data.current_power || 0;

                        if (actualEsChart.data.datasets.length === 0) {
                            actualEsChart.data.datasets.push({
                                label: 'Difference in power consumption between modes',
                                data: [startingPower, currentPower],
                                backgroundColor: ['darkgray', 'green'],
                            });
                            actualEsChart.data.labels = [
                                'Network power usage\nwith ES disabled',
                                'Current network\npower usage'
                            ];
                        } else {
                            actualEsChart.data.datasets[0].data = [startingPower, currentPower];
                            actualEsChart.data.labels = [
                                'Network power usage\nwith ES disabled',
                                'Current network\npower usage'
                            ];
                        }

                        actualEsChart.update();
                        11
                    } else {
                        console.error("Chart instance is not initialized.");
                    }


                    document.getElementById('ueSourceData').innerHTML = formatAndDisplayCellData(data.ues);
                    document.getElementById('cellSourceData').innerHTML = formatAndDisplayCellData(data.cells);

                    const legendContainer = document.getElementById('chart-legend');
                    legendContainer.innerHTML = '';

                    cellData.forEach(cell => {
                        const legendItem = document.createElement('div');
                        legendItem.className = 'legend-item';

                        const colorBox = document.createElement('div');
                        colorBox.className = 'legend-color-box';
                        colorBox.style.backgroundColor = cell.backgroundColor;

                        const legendText = document.createElement('span');
                        legendText.className = 'legend-text';
                        legendText.textContent = `
                        Cell ${cell.cell_id} (${cell.type})`;

                        legendItem.appendChild(colorBox);
                        legendItem.appendChild(legendText);
                        legendContainer.appendChild(legendItem);
                    });

                    const isChartViewActive = document.getElementById('chart-content').classList.contains('active');
                    if (isChartViewActive) {
                        legendContainer.classList.add('horizontal');
                        legendContainer.classList.remove('vertical');
                    } else {
                        legendContainer.classList.add('vertical');
                        legendContainer.classList.remove('horizontal');
                    }
                });
    }


    document.getElementById('form-toggle-button').addEventListener('click', () => {
        const formContainer = document.getElementById('form-container');
        const button = document.getElementById('form-toggle-button');
        if (formContainer.style.display === 'none' || formContainer.style.display === '') {
            formContainer.style.display = 'block';
            button.textContent = 'Hide simulation setup';
        } else {
            formContainer.style.display = 'none';
            button.textContent = 'Show simulation setup';
        }
    });

    /*
    document.getElementById('toggleButton').addEventListener('click', () => {
        const formContainer = document.getElementById('form-container');
        const button = document.getElementById('toggleButton');
        if (formContainer.style.display === 'none' || formContainer.style.display === '') {
            formContainer.style.display = 'block';
            button.textContent = 'Hide A1 policy manager';
        } else {
            formContainer.style.display = 'none';
            button.textContent = 'Show A1 policy manager';
        }
    });
    const toggleButton = document.getElementById('toggleButton');
    toggleButton.addEventListener('click', () => {
        frameContainer.classList.toggle('hidden');
    });
    */
    document.getElementById('toggleButton').addEventListener('click', () => {
        alert('This functionality is currently disabled due to missing features');
    });

    const frameContainer = document.getElementById('frameContainer');


    // Fetch GET request
    const fetchData = (endpoint, responseId) => {
        fetch(endpoint)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    document.getElementById(responseId).innerText = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    document.getElementById(responseId).innerText = `Error: ${error.message}`;
                });
    };

    const host_ns3 = "{{ host_ns3 }}";
    // Assign GET buttons
    document.getElementById('fetchData1').addEventListener('click', () => {
        const url = `http://${host_ns3}:9000/a1-p/policytypes`;
        fetchData(url, 'response1');

    });

    document.getElementById('fetchData2').addEventListener('click', () => {
        const param1 = document.getElementById('param1').value;
        if (param1 == '' || isNaN(param1)) {
            document.getElementById('response2').innerText = "'POLICY TYPE id:' must be fulfilled.";
        } else {
            const url = `http://${host_ns3}:9000/a1-p/policytypes/${param1}`;
            fetchData(url, 'response2');
        }
    });

    document.getElementById('fetchData3').addEventListener('click', () => {
        const param1 = document.getElementById('param1').value;
        if (param1 === '' || isNaN(param1)) {
            document.getElementById('response3').innerText = "'POLICY TYPE id:' must be fulfilled.";
        } else {
            const url = `http://${host_ns3}:9000/a1-p/policytypes/${param1}/policies`;
            fetchData(url, 'response3');
        }
    });

    document.getElementById('fetchData4').addEventListener('click', () => {
        const param1 = document.getElementById('param1').value;
        const param2 = document.getElementById('param2').value;
        if (param1 === '' || isNaN(param1)) {
            document.getElementById('response4').innerText = "'POLICY TYPE id:' and 'POLICY INSTANCE id:' must be fulfilled";
        } else if (param2 === '' || !(typeof param2 === 'string' || param2 instanceof String)) {
            document.getElementById('response4').innerText = "'POLICY TYPE id:' and 'POLICY INSTANCE id:' must be fulfilled";
        } else {
            const url = `http://${host_ns3}:9000/a1-p/policytypes/${param1}/policies/${param2}/status`;
            fetchData(url, 'response4');
        }
    });

    // Send PUT request
    const sendPutRequest = (params, jsonId, responseId, endpoint) => {
        const jsonPayload = document.getElementById(jsonId).value;
        const param1 = document.getElementById('param1').value;
        if (param1 === '' || isNaN(param1)) {
            document.getElementById(responseId).innerText = "'POLICY TYPE id:' must be fulfilled.";
            return;
        }
        if (jsonPayload === '') {
            document.getElementById(responseId).innerText = "A valid JSON should be provided";
            return;
        }
        const queryString = params
                .map(({id, name}) => `${encodeURIComponent(document.getElementById(id).value)}`)
                .join('&');

        try {
            const payload = JSON.parse(jsonPayload); // Validate JSON
            fetch(`${endpoint}${queryString}`, {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload),
            })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        document.getElementById(responseId).innerText = JSON.stringify(data, null, 2);
                    })
                    .catch(error => {
                        document.getElementById(responseId).innerText = `Error: ${error.message}`;
                    });
        } catch (err) {
            document.getElementById(responseId).innerText = `Invalid JSON: ${err.message}`;
        }
    };

    // Assign PUT buttons
    document.getElementById('sendPut1').addEventListener('click', () => {
        const url = `http://${host_ns3}:9000/a1-p/policytypes/`;
        sendPutRequest(
                [{id: 'param1', name: 'parameter'}],
                'putJson1',
                'putResponse1',
                url
        );
    });

    const sendPutRequest2 = (param1, param2, jsonPayload, responseId) => {
        const url = `http://${host_ns3}:9000/a1-p/policytypes/${param1}/policies/${param2}`;
        try {
            const bodyPayload = JSON.stringify(jsonPayload);
            fetch(url, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: bodyPayload
            })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Display the response in the specified element
                        document.getElementById(responseId).innerText = JSON.stringify(data, null, 2);
                    })
                    .catch(error => {
                        // Display error messages
                        document.getElementById(responseId).innerText = `Error: ${error.message}`;
                    });
        } catch (err) {
            // Display error for invalid JSON
            document.getElementById(responseId).innerText = `Invalid JSON payload: ${err.message}`;
        }
    };

    document.getElementById('sendPut2').addEventListener('click', () => {
        const param1 = document.getElementById('param1').value;
        const param2 = document.getElementById('param2').value;
        const jsonText = document.getElementById('putJson2').value;
        if (param1 === '' || isNaN(param1)) {
            document.getElementById('putResponse2').innerText = "'POLICY TYPE id:' and 'POLICY INSTANCE id:' must be fulfilled.";
            return;
        } else if (param2 === '' || !(typeof param2 === 'string' || param2 instanceof String)) {
            document.getElementById('putResponse2').innerText = "'POLICY TYPE id:' and 'POLICY INSTANCE id:' must be fulfilled.";
            return;
        } else if (jsonText === '') {
            document.getElementById('putResponse2').innerText = "A valid JSON should be provided";
            return;
        }
        const jsonPayload = JSON.parse(jsonText || '{}');
        sendPutRequest2(param1, param2, jsonPayload, 'putResponse2');
    });

    document.getElementById('chart-tab').addEventListener('click', () => {
        document.getElementById('chart-content').classList.add('active');
        document.getElementById('data-content').classList.remove('active');
        document.getElementById('chart-content').style.display = 'flex'
        document.getElementById('es-content').classList.remove('active');
        document.getElementById('chart-tab').classList.add('active');
        document.getElementById('data-tab').classList.remove('active');
        document.getElementById('es-tab').classList.remove('active');
        updateChart();
    });

    document.getElementById('data-tab').addEventListener('click', () => {
        document.getElementById('chart-content').classList.remove('active');
        document.getElementById('data-content').classList.add('active');
        document.getElementById('chart-content').style.display = 'flex'
        document.getElementById('es-content').classList.remove('active');
        document.getElementById('chart-tab').classList.remove('active');
        document.getElementById('data-tab').classList.add('active');
        document.getElementById('es-tab').classList.remove('active');
        updateChart();
    });

    document.getElementById('es-tab').addEventListener('click', () => {
        document.getElementById('chart-content').classList.remove('active');
        document.getElementById('data-content').classList.remove('active');
        document.getElementById('chart-content').style.display = 'none'
        document.getElementById('es-content').classList.add('active');
        document.getElementById('chart-tab').classList.remove('active');
        document.getElementById('data-tab').classList.remove('active');
        document.getElementById('es-tab').classList.add('active');
        updateChart();
    });

    document.getElementById('simulationForm').addEventListener('submit', (event) => {
        event.preventDefault();
    });

    setInterval(updateChart, 2000);
    updateChart();

    function sendForm(endpoint) {
        const form = document.getElementById('simulationForm');
        const formData = new FormData(form);
        const data = {};

        formData.forEach((value, key) => {
            if (value.trim() !== '') {
                data[key] = value;
            }
        });

        console.log('Data to be sent:', data);
        const statusLabel = document.getElementById('status_label');
        const startButton = document.getElementById('start_button')
        const stopButton = document.getElementById('stop_button')
        const warninglabel = document.getElementById('warning_label')
        statusLabel.textContent = 'Simulation starting';
        startButton.disabled = true
        stopButton.disabled = false
        resetSim()
        fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    statusLabel.textContent = 'Simulation running';
                    warninglabel.textContent = 'Warning: if there are no Cells/UEs on the grid after max 30s, please check if ns3 is running properly typing in terminal "ps -a" or "cat ns-3-mmwave-oran/ns3_run.log"';

                })
                .catch((error) => {
                    console.error('Error:', error);
                    statusLabel.textContent = 'Error while starting up the simulation';
                    startButton.disabled = false
                    stopButton.disabled = true
                });
    }

    function stopSim(endpoint) {
        const statusLabel = document.getElementById('status_label');
        statusLabel.textContent = 'Stopping simulation';
        const startButton = document.getElementById('start_button')
        const stopButton = document.getElementById('stop_button')
        const resetButton = document.getElementById('reset_button')
        startButton.disabled = false
        stopButton.disabled = true
        resetButton.disabled = false
        fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    statusLabel.textContent = 'Simulation stopped';
                })
                .catch((error) => {
                    console.error('Error:', error);
                    statusLabel.textContent = 'Error encountered while stopping the simulation';

                });
    }

    function resetSim(endpoint) {
        const statusLabel = document.getElementById('status_label');
        statusLabel.textContent = 'Resetting simulation';
        const resetButton = document.getElementById('reset_button')
        resetButton.disabled = true
        const sim_id_label = document.getElementById('simid_label')
        sim_id_label.textContent = "None"
        const esChart = Chart.getChart('es-mode-chart');
        esChart.data.datasets = [];
        esChart.update();
        const sinrChart = Chart.getChart('sinr-chart');
        sinrChart.data.datasets = [];
        sinrChart.update();
        const retxChart = Chart.getChart('retx-chart');
        retxChart.data.datasets = [];
        retxChart.update();
        const prbChart = Chart.getChart('prb-usage-chart');
        prbChart.data.datasets = [];
        prbChart.update();
        const diffChart = Chart.getChart('es_diff');
        diffChart.data.datasets = [];
        diffChart.update();

        fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    statusLabel.textContent = 'off';

                })
                .catch((error) => {
                    console.error('Error:', error);
                    statusLabel.textContent = 'Error encountered while resetting the simulation';
                });
    }


    function startEs() {
        const esStatusLabel = document.getElementById('es_status_label')
        esStatusLabel.textContent = 'Sending start request to a xApp'

        fetch('/startes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
                .then(response => {
                    if (response.ok) {
                        esStatusLabel.textContent = 'on';
                    } else {
                        esStatusLabel.textContent = 'Unexpected error has occurred';
                    }
                })
                .catch(error => {
                    if (error.name === 'AbortError') {
                        esStatusLabel.textContent = 'Connection timed out, try again later';
                    } else {
                        console.error('Error:', error);
                        esStatusLabel.textContent = 'Unexpected error has occurred';
                    }
                });
    }

    function stopEs() {
        const esStatusLabel = document.getElementById('es_status_label')
        esStatusLabel.textContent = 'Sending stop request to a xApp'

        fetch('/stopes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
                .then(response => {
                    if (response.ok) {
                        esStatusLabel.textContent = 'off';
                    } else {
                        esStatusLabel.textContent = 'Unexpected error has occurred';
                    }
                })
                .catch(error => {
                    if (error.name === 'AbortError') {
                        esStatusLabel.textContent = 'Connection timed out, try again later';
                    } else {
                        console.error('Error:', error);
                        esStatusLabel.textContent = 'Unexpected error has occurred';
                    }
                });
    }

    function formatAndDisplayCellData(data) {
        return data.map(cell => {
            return `<div class="object-box">${Object.entries(cell)
                    .map(([key, value]) => `${key}: <span class="value">${value === null || value === "" ? "N/A" : value}</span>`
        )
        .
            join("<br>")
        }
    </div>
        `;
                    }).join("");
                }
</script>
</body>
</html>
